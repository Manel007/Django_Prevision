<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soil Type Prediction</title>
    
    <!-- Add Bootstrap CSS for styling -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    
    <!-- Add jQuery and Bootstrap JS for interactivity -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        // Function to handle the form submission
        async function submitForm(event) {
            event.preventDefault(); // Prevent the default form submission behavior

            const formData = new FormData(event.target); // Collect form data

            try {
                // Send a POST request to the server with the form data
                const response = await fetch('/predict-soil/', {
                    method: 'POST',
                    body: formData // Attach the form data to the request body
                });

                // Check for a successful response
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('Error response:', errorText);
                    showModal('Error', 'Error: ' + errorText); // Show error in a modal
                    return;
                }

                // Parse the JSON response to get the predicted soil type
                const data = await response.json();
                console.log('Predicted soil type:', data.predicted_soil_type);
                showModal('Predicted Soil Type', data.predicted_soil_type); // Display the prediction in a modal
            } catch (error) {
                console.error('Fetch error:', error);
                showModal('Error', 'An error occurred: ' + error); // Show error in a modal
            }
        }

        // Function to display a modal with the prediction result
        function showModal(title, message) {
            document.getElementById('modalTitle').innerText = title; // Set the modal title
            document.getElementById('modalBody').innerText = message; // Set the modal message
            $('#resultModal').modal('show'); // Show the modal
        }
    </script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <h1 class="text-center mb-4">Soil Type Prediction</h1>
        
        <!-- Introduction to the tool -->
        <div class="text-center mb-4">
            <p>Welcome to the Soil Type Prediction tool! This application allows you to predict the type of soil based on key characteristics. By entering specific values for pH level, organic matter, and nutrient content, you can obtain a prediction of the soil type.</p>
            <p>Simply fill out the form below with the required information, and click the "Predict Soil Type" button. A modal will pop up displaying the predicted soil type based on your inputs.</p>
            <p>Whether you're a farmer, gardener, or just curious about soil types, this tool is designed to provide you with quick and helpful predictions!</p>
        </div>
        
        <form id="soilPredictionForm" onsubmit="submitForm(event)" method="POST">
            {% csrf_token %} <!-- Include CSRF token for security in Django applications -->
            <div class="form-group">
                <input type="number" name="pH_level" class="form-control" placeholder="pH Level" required>
            </div>
            <div class="form-group">
                <input type="number" name="organic_matter" class="form-control" placeholder="Organic Matter (%)" required>
            </div>
            <div class="form-group">
                <input type="number" name="nitrogen_content" class="form-control" placeholder="Nitrogen Content (kg/ha)" required>
            </div>
            <div class="form-group">
                <input type="number" name="phosphorus_content" class="form-control" placeholder="Phosphorus Content (kg/ha)" required>
            </div>
            <div class="form-group">
                <input type="number" name="potassium_content" class="form-control" placeholder="Potassium Content (kg/ha)" required>
            </div>
            <button type="submit" class="btn btn-primary btn-block">Predict Soil Type</button>
        </form>
    </div>

    <!-- Modal for displaying prediction results -->
    <div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Prediction result will be displayed here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
